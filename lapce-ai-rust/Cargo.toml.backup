[package]
name = "lapce-ai-rust"
version = "0.1.0"
edition = "2021"
authors = ["Lapce AI Team"]
license = "MIT"
description = "High-performance AI integration for Lapce IDE"
repository = "https://github.com/lapce/lapce-ai-rust"

[lib]
name = "lapce_ai_rust"
path = "src/lib.rs"

[[bin]]
name = "lapce-ai-rust"
path = "src/main.rs"

[[example]]
name = "verify_cache_performance"
path = "examples/verify_cache_performance.rs"

[[example]]
name = "comprehensive_architecture_test"
path = "examples/comprehensive_architecture_test.rs"

[[example]]
name = "standalone_8_criteria_test"
path = "examples/standalone_8_criteria_test.rs"

[[example]]
name = "test_100k_files"
path = "examples/test_100k_files.rs"

[[example]]
name = "test_real_search"
path = "examples/test_real_search.rs"

[[example]]
name = "benchmark_real_server"
path = "examples/benchmark_real_server.rs"

[[example]]
name = "shared_memory_benchmark"
path = "examples/shared_memory_benchmark.rs"

[[example]]
name = "honest_benchmark"
path = "examples/honest_benchmark.rs"

[[example]]
name = "simple_working_test"
path = "examples/simple_working_test.rs"

[[example]]
name = "truly_integrated_server"
path = "examples/truly_integrated_server.rs"

[dependencies]
uuid = { version = "1.0", features = ["v4"] }
# Core dependencies for MCP tools
async-trait = "0.1"
thiserror = "1.0"
tokio-util = { version = "0.7", features = ["codec"] }
anyhow = "1.0"
tokio = { version = "1.39", features = ["full"] }
tracing = "0.1"

# Existing dependencies
notify = "6.0"
notify-debouncer-full = "0.3"
futures-util = "0.3"
# ort = { version = "1.16", features = ["download-binaries"] } # Disabled - compilation errors
clap = { version = "4.5", features = ["derive"] }
dirs = "5.0"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
blake3 = "1.8"
walkdir = "2.4"
# LanceDB and Arrow for vector database
lancedb = "0.4"
arrow = "51.0"
arrow-array = "51.0"
arrow-schema = "51.0"
# Pin zstd versions to resolve conflicts
zstd = "0.13"
zstd-safe = "7.2.4"
zstd-sys = "2.0.13"

# Temporarily disable Qdrant
# qdrant-client = "1.7"

# Candle for BERT embeddings
candle-core = "0.3"
candle-nn = "0.3"
candle-transformers = "0.3"
tokenizers = "0.15"

# Tantivy for keyword search
tantivy = "0.21"

# Alternative: use fastembed for embeddings (lighter weight)
# fastembed = "3.0"

nix = { version = "0.27", features = ["process", "resource"] }
pin-project = "1.1"
rustix = { version = "0.38", features = ["thread"] }

# Error handling
# anyhow = "1.0" # Already defined above at line 63

# HTTP client for Titan Embeddings - using existing reqwest dependency above
aws-sigv4 = "1.1"
aws-credential-types = "1.1"
hmac = "0.12"
sha2 = "0.10"
# hex = "0.4" # duplicate
dotenv = "0.15"

# Logging already included above

# Caching
# sled = "0.34" # Already defined above
redis = { version = "0.24", features = ["tokio-comp", "aio", "connection-manager"] }
bloomfilter = "1.0.14"

# Tree-sitter for code parsing
tree-sitter = "0.20"
tree-sitter-rust = "0.20"
tree-sitter-python = "0.20"
tree-sitter-javascript = "0.20"
tree-sitter-typescript = "0.20"

# Additional dependencies (mio, nix, libc, chrono already declared above)

# Networking

# IPC True Port Dependencies
validator = { version = "0.18", features = ["derive"] }
lazy_static = "1.5"

# HTTP & Networking  
# reqwest = { version = "0.12", features = ["json", "stream", "rustls-tls"] } # Already defined above
bb8 = "0.8"
# axum = "0.7" # Duplicate - already declared above
# Performance monitoring (additional metrics libraries)
rocksdb = { version = "0.21", default-features = false, features = ["lz4", "snappy"] }
metrics-exporter-prometheus = "0.15"
prometheus = "0.13"
# lazy_static = "1.4" # Already defined above
# csv = "1.3" # Already defined above
# Duplicates removed - already defined above

# Monitoring & Metrics
opentelemetry = { version = "0.21", features = ["trace"] }
opentelemetry-otlp = { version = "0.13", features = ["tonic", "trace"] }
pprof = { version = "0.13", features = ["flamegraph", "protobuf-codec"] }
jemalloc-ctl = "0.5"
sysinfo = "0.30"

# Compression already defined above

# Vector search and embeddings - PRODUCTION READY
hf-hub = { version = "0.3", features = ["tokio"] }  # Hugging Face model downloads
# ort already defined above for MiniLM embeddings
# ndarray already defined above

# Caching and utilities
# blake3 = "1.8" # Already defined above
# moka = { version = "0.12", features = ["future"] } # Already defined above
# notify = "6.1" # Already defined above
# notify-debouncer-full = "0.3" # Already defined above
# uuid = { version = "1.7", features = ["v4", "serde"] } # Duplicate
lru = "0.12"

# Tree-sitter
# tree-sitter = "0.22.6" # Duplicate
# tree-sitter-rust = "0.13" # Duplicate
# tree-sitter-python = "0.21" # Duplicate
# tree-sitter-javascript = "0.21" # Duplicate
# tree-sitter-typescript = "0.21" # Duplicate

# Text search
dashmap = "5.5"
bytes = "1.5"
http = "1.0"

# Performance monitoring
tokio-tungstenite = "0.21"

# String interning
lasso = { version = "0.7", features = ["multi-threaded"] }
# walkdir = "2.5" # Already declared above

# Utilities
# once_cell = "1.19" # Already defined above

# MCP Tools dependencies
# quick-xml = "0.31" # Already defined above
shell-words = "1.1"

[dev-dependencies]
tempfile = "3.8"
criterion = "0.5"

[[bench]]
name = "performance_benchmark"
harness = false
proptest = "1.5"
tempfile = "3.10"
tokio-test = "0.4"
